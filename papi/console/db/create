<?php
declare(strict_types=1);

require 'vendor/autoload.php';

use config\DatabaseConfig;
use papi\CLI\ConsoleOutput;

$host = DatabaseConfig::getServer();
$user = DatabaseConfig::getUsername();
$password = DatabaseConfig::getPassword();
$name = DatabaseConfig::getName();
$type = DatabaseConfig::getType();

try {
    $db = "$type:host=$host";
    $statement = "CREATE DATABASE `$name`;";
    if ($type === 'pgsql') {
        $db .= ';dbname=postgres';
        $statement = "CREATE DATABASE $name OWNER $user;";
    }
    $dbh = new PDO($db, $user, $password);
    $dbh->exec($statement);
} catch (PDOException $e) {
    ConsoleOutput::errorDie("DB ERROR: ".$e->getMessage());
}
ConsoleOutput::success("Database created ($type)");
